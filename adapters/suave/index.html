<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        <meta name="author" content="Henrik Feldt">
        <link rel="canonical" href="https://logary.github.io/adapters/suave/">
        <link rel="shortcut icon" href="../../img/favicon.ico">

        <title>Suave</title>

        <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../../css/font-awesome-4.0.3.css" rel="stylesheet">
        <link href="../../css/prettify-1.0.css" rel="stylesheet">
        <link href="../../css/base.css" rel="stylesheet">
        
            <link href="../../../../css/fixes.css" rel="stylesheet" />
        

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->
        

        
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <!-- Main title -->
            <a class="navbar-brand" href="../..">Logary</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
            <!-- Main navigation -->
            <ul class="nav navbar-nav">
            
            
                <li >
                    <a href="../..">Home</a>
                </li>
            
            
            
                <li >
                    <a href="../../api/">API</a>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Targets <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../targets/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/textwriter/">TextWriter</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/console/">Console</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/debugger/">Debugger</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/file/">File</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/logstash/">Logstash</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/graphite/">Graphite</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/elmahio/">ElmahIO</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/logentries/">Logentries</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/loggr/">Loggr</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/riemann/">Riemann</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/db/">DB</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/nimrod/">Nimrod</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/dash/">Dash</a>
                        </li>
                    
                        <li >
                            <a href="../../targets/zipkin/">Zipkin</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown active">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Adapters <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../eventstore/">EventStore</a>
                        </li>
                    
                        <li class="active">
                            <a href="./">Suave</a>
                        </li>
                    
                        <li >
                            <a href="../topshelf/">Topshelf</a>
                        </li>
                    
                        <li >
                            <a href="../log4net/">log4net</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown">Advanced <b class="caret"></b></a>
                    <ul class="dropdown-menu">
                    
                        <li >
                            <a href="../../advanced/overview/">Overview</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/v2-refactor/">v2.0-refactor</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/reservoirs/">Reservoirs</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/writing-a-target/">Writing a Target</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/writing-a-metric/">Writing a Metric</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/thinking-about-time/">Thinking About Time</a>
                        </li>
                    
                        <li >
                            <a href="../../advanced/contributing/">Contributing</a>
                        </li>
                    
                    </ul>
                </li>
            
            
            
                <li >
                    <a href="../../about/">About</a>
                </li>
            
            
            </ul>

            <!-- Search, Navigation and Repo links -->
            <ul class="nav navbar-nav navbar-right">
                
                <li >
                    <a rel="next" href="../eventstore/">
                        <i class="fa fa-arrow-left"></i> Previous
                    </a>
                </li>
                <li >
                    <a rel="prev" href="../topshelf/">
                        Next <i class="fa fa-arrow-right"></i>
                    </a>
                </li>
                
                <li>
                    <a href="https://github.com/logary/logary/">
                        
                            <i class="fa fa-github"></i>
                        
                        GitHub
                    </a>
                </li>
                
            </ul>
        </div>
    </div>
</div>

        <div class="container">
            <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
    
        <li class="main active"><a href="#clavigeri-per-absensauxilium-invenies">Using Suave 2.0 Adapter</a></li>
        
            <li><a href="#successu-amnis-quae-felix-expalluit-diversaque-fauni">Successu amnis quae felix expalluit diversaque fauni</a></li>
        
            <li><a href="#illa-sustulit-quae-capacibus-vocantem-sollicitare-vocat">Illa sustulit quae capacibus vocantem sollicitare vocat</a></li>
        
            <li><a href="#est-et-similis-annis-vides-ut-litora">Est et similis annis vides ut litora</a></li>
        
    
    </ul>
</div></div>
            <div class="col-md-9" role="main">

<h1 id="using-suave-20-adapter">Using Suave 2.0 Adapter</h1>

<p>In order to integrate Logary with Suave 2.0, the strategy now is to use the adapter that basically receives events from 
    Suave and makes them available to be used inside Logary. </p>

<p>In the example below, we configure are able to configure Suave adapter and then filter the logs to show only Information 
    log level. The idea is that you can configure a rule in Logary to filter the logs received to fit your needs. Let's how 
    this works: </p>

<p><strong>F#</strong></p>
<pre><code class="fsharp">
open System

open Suave
open Suave.Successful
open Suave.RequestErrors
open Suave.Operators
open Suave.RequestErrors
open Suave.Filters
open Suave.Logging

open Logary
open Logary
open Logary.Configuration
open Logary.Targets
open Logary.Metric
open Logary.Metrics
open Logary.Message
open Logary.Adapters.Facade

open NodaTime
open Hopac



[<EntryPoint>]
let main argv = 

    // this is our logManager.
    let logary =
      withLogaryManager "TestApi" (
        
        // configure here some rules. You can change parts of the rule using the construct below.
        // note also that you can add many different rules here. So here we are adding to the rules 
        // an instruction to configure the "console" target, with the minimum log level to be Info, which
        // will hide verbose logs of Suave. 
        withRules 
            [
               { Rule.createForTarget "console" with level = Info  }
            ]
        // the literate console target is used to output text in different colors for different types of logs. Much 
        // nicer than the normal console.
        >> withTarget (LiterateConsole.create LiterateConsole.empty "console")
        
        // the Logary configuration itself is a representation of a Hopac job, that is only defined but not executed
        // until the it's told to be executed. So we use run to ask for immediate execution.
      ) |> run

    // this is the most important part - initializes the Logary with a Suave logger.
    LogaryFacadeAdapter.initialise<Suave.Logging.Logger> logary

    // gets a logger from the context of this function
    let logger = Logging.getCurrentLogger()

    // this is a function that is called when a post request is received. Note that the logger here is the Logary's one.
    let logInsidePost (logger: Logger) =
        
        // imperatively logs something to be shown on the coloured console defined above. The log level defined on the 
        // rule above still applies here. Only information and above will be shown.
        logger.info (
            eventX  "********hello world************"
        )
        OK "postOk"


    let testApi  = 
        choose
            [
                // when a POST request is received, the function will run and log normally.
                POST >=> path "/post" >=> warbler (fun x -> logInsidePost logger)
                NOT_FOUND "Found no handlers"
            ]
   
    // we don't need to change the config anymore, as we used to do in previous version of Suave
    startWebServer defaultConfig testApi 
    
    Console.ReadLine() |> ignore
    0
</code></pre>

        

        <script src="https://code.jquery.com/jquery-1.10.2.min.js"></script>
        <script src="../../js/bootstrap-3.0.3.min.js"></script>
        <script src="../../js/prettify-1.0.min.js"></script>
        <script src="../../js/base.js"></script>
    </body>
</html>